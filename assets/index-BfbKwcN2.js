var L=Object.defineProperty;var w=(n,e,i)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var E=(n,e,i)=>w(n,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();document.querySelectorAll(".form-select-chosen").forEach(n=>{try{let p=function(c){let v=0;u.querySelectorAll(".form-select-chosen__option:not(.is-not-search)").forEach(h=>{h.textContent.toLowerCase().startsWith(c.toLowerCase())?(h.style.display="",v++):h.style.display="none"}),v?u.classList.remove("is-empty"):u.classList.add("is-empty")},a=function(c){c.classList.contains("form-select-chosen__option")&&c.addEventListener("click",function(v){t=!1,d.classList.remove("is-visible"),s.value=c.getAttribute("data-value"),l.textContent=c.textContent,u.querySelectorAll(".form-select-chosen__option").forEach(h=>h.classList.remove("is-selected")),c.classList.add("is-selected"),f.value="",p(""),s.dispatchEvent(new Event("change"))})};var e=p,i=a;let t=!1,r=!1;const s=n.querySelector(".form-select-chosen__input"),l=n.querySelector(".form-select-chosen__output"),m=n.querySelector(".form-select-chosen__output-wrap"),d=n.querySelector(".form-select-chosen__search"),f=n.querySelector(".form-select-chosen__search-input"),u=n.querySelector(".form-select-chosen__options");!s&&console.error("not .form-select-chosen__input: ",n),!l&&console.error("not .form-select-chosen__output: ",n),!m&&console.error("not .form-select-chosen__output-wrap: ",n),!d&&console.error("not .form-select-chosen__search: ",n),!f&&console.error("not .form-select-chosen__search-input: ",n),!u&&console.error("not .form-select-chosen__options: ",n),m.addEventListener("click",()=>{d.classList.toggle("is-visible"),t=!t,t&&(r=!0),t&&f.focus()}),document.addEventListener("click",c=>{t&&!r&&c.target.closest(".form-select-chosen__search")!==d&&(t=!1,d.classList.remove("is-visible"),f.value="",p("")),r=!1}),f.addEventListener("input",c=>{p(c.target.value)}),u.querySelectorAll(".form-select-chosen__option").forEach(c=>a(c)),new MutationObserver(function(c,v){for(let h of c)h.type==="childList"&&(h.addedNodes.forEach(g=>a(g)),s.value=0,l.textContent="")}).observe(u,{childList:!0})}catch(t){console.log(t)}});const o=class o{constructor(e,i){if(!(e instanceof HTMLFormElement))throw new Error("Не форма");this.form=e,this.config=i,this.request=new Request(this.form.action,{method:"post",credentials:"same-origin",headers:{Accept:"application/json"}}),this.prepareEvents(),o.forms.push(this.form),o.instances.set(this.form,this)}prepareEvents(){this.form.addEventListener("submit",async e=>{var t,r,s,l,m,d,f,u;e.preventDefault(),this.formData=new FormData(this.form),this.clearErrors();const i=new CustomEvent(o.events.before,{cancelable:!0,detail:{form:this.form,formData:this.formData,attForm:this}});if((r=(t=o==null?void 0:o.Message)==null?void 0:t.before)==null||r.call(t),!!document.dispatchEvent(i)){this.disableFields();try{const a=await(await fetch(this.request,{body:this.formData})).json(),c=new CustomEvent(o.events.after,{cancelable:!0,detail:{form:this.form,formData:this.formData,response:a,attForm:this}});if((l=(s=o==null?void 0:o.Message)==null?void 0:s.after)==null||l.call(s,a.message),!document.dispatchEvent(c))return;if(!a.success){(d=(m=o==null?void 0:o.Message)==null?void 0:m.error)==null||d.call(m,a.message);const h=new CustomEvent(o.events.error,{cancelable:!0,detail:{form:this.form,formData:this.formData,response:a,attForm:this}});if(!document.dispatchEvent(h))return;for(const[g,b]of Object.entries(a.errors))this.setError(g,b);return}this.clearErrors(),(u=(f=o==null?void 0:o.Message)==null?void 0:f.success)==null||u.call(f,a.message);const v=new CustomEvent(o.events.success,{detail:{form:this.form,formData:this.formData,response:a,attForm:this}});if(!document.dispatchEvent(v))return;typeof window.grecaptcha<"u"&&window.grecaptcha.reset(),this.config.clearFieldsOnSuccess&&this.form.reset()}catch(p){console.error(p)}finally{this.enableFields()}}}),this.form.addEventListener("reset",()=>{var i,t;const e=new CustomEvent(o.events.reset,{detail:{form:this.form,attForm:this}});document.dispatchEvent(e),this.clearErrors(),(t=(i=o==null?void 0:o.Message)==null?void 0:i.reset)==null||t.call(i)}),["change","input"].forEach(e=>{this.form.addEventListener(e,({target:i})=>{this.clearError(i.getAttribute("name"))})})}clearErrors(){this.fields.forEach(e=>this.clearError(e.getAttribute("name")))}clearError(e){const i=this.getFields(e);i.forEach(s=>{this.inputInvalidClasses&&s.classList.remove(...this.inputInvalidClasses),s.removeAttribute("aria-invalid")});const t=this.getErrors(e);t.forEach(s=>{s.style.display="none",s.innerHTML=""});const r=this.getCustomErrors(e);return this.customInvalidClasses&&r.forEach(({classList:s})=>s.remove(...this.customInvalidClasses)),{fields:i,errors:t,customErrors:r}}setError(e,i=""){this.getFields(e).forEach(t=>{this.inputInvalidClasses&&t.classList.add(...this.inputInvalidClasses),t.setAttribute("aria-invalid",!0)}),this.customInvalidClasses&&this.getCustomErrors(e).forEach(({classList:t})=>t.add(...this.customInvalidClasses)),this.getErrors(e).forEach(t=>{t.style.display="",t.innerHTML=i})}enableFields(){this.elements.forEach(e=>e.removeAttribute("disabled"))}disableFields(){this.elements.forEach(e=>e.setAttribute("disabled",""))}getFields(e){return e?Array.from(this.form.querySelectorAll(`[name="${e}"], [name="${e}[]"]`)):[]}getErrors(e){return e?Array.from(this.form.querySelectorAll(`[data-error="${e}"], [data-error="${e}[]"]`)):[]}getCustomErrors(e){return e?Array.from(this.form.querySelectorAll(`[data-custom="${e}"]`)):[]}get elements(){return Array.from(this.form.elements)}get fields(){return this.elements.filter(({tagName:e})=>["select","input","textarea"].includes(e.toLowerCase()))}get inputInvalidClasses(){return this.config.inputInvalidClass?this.config.inputInvalidClass.split(" "):[]}get customInvalidClasses(){return this.config.customInvalidClass?this.config.customInvalidClass.split(" "):[]}static sanitizeHTML(e=""){return e.replace(/(<([^>]+)>)/gi,"")}static create(e,i){const t=document.querySelectorAll(`form[data-att-form="${e}"]`);if(!t)throw new Error(`В документе не найдено форм по селектору: form[data-att-form="${e}"]`);t.forEach(r=>{new this(r,i)})}};E(o,"forms",[]),E(o,"instances",new Map),E(o,"events",{before:"att-form:before",success:"att-form:success",error:"att-form:error",after:"att-form:after",reset:"att-form:reset"});let y=o;window.AttForm=y;
